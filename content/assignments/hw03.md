---
title: "Refactor/Extension"
type: "homework"
num: "3"
draft: 1
assigned_date: "2026-02-05"
due_date: "2026-02-12"
heading_max_level: 3
---

> ## Overview
> 
> This assignment has 4 parts:
> 1. **Refactor Existing Code** - Improve the design of existing functionality
> 1. **Extend an Existing Feature** - Add a small enhancement to some part of the codebase
> 1.  **Peer Review** - Review a teammateâ€™s PR
> 1. **Individual Reflection** - Reflect on what refactoring taught you about code quality
> 
> This assignment builds on design principles and refactoring practice from class. You'll improve code quality using tests as guardrails.
> 
> **Suggested division of labor:** With 4 team members, consider splitting into pairs: 2 people on refactoring, 2 people on extension. Then, each pair can review the other pair's PR.


## 1. Refactor Existing Code

### 1.1. Identify "Code Smell"

Find backend code that could be improved:
<div class="list-tight">

- Long functions (> 20 lines)
- Repeated code (DRY violations)
- Low cohesion (functions do multiple things)
- Unclear names or structure

</div>

Document the issue using the GitHub Issue Tracker:
<div class="list-tight">


- What file/function has the issue?
- What design principle does it violate?
- How does it impact maintainability?

</div>

Suggestions for possible enhancements:

<div class="list-tight">

- `backend/routes/groups.py`: Extract group name validation (lines 259-264, 323-328)
- `backend/routes/groups.py`: Member count calculation is repeated (lines 118-121, 184-187, 292-299, 341-344)
- `backend/routes/courses.py`: Module count calculation (currently hardcoded to 0)
- `backend/routes/groups.py`: Long functions like `get_all_groups()` (lines 89-133) could be split
</div>

### 1.2. Write/Update Tests

Ensure tests exist and cover the behavior:

<div class="list-tight">

- If tests exist: Review them, ensure they cover the behavior
- If tests don't exist: Write tests for the current behavior

</div>

Test requirements:

<div class="list-tight">

- Success cases: Valid input, correct response
- Failure cases: Invalid input, errors
- Edge cases: Boundary conditions

</div>

Run tests to establish baseline:

```bash
docker exec -it tma_backend poetry run pytest -v
```
<div class="list-tight">

- All tests should pass
- This is your baseline (tests verify behavior doesn't change)

</div>


### 1.3. Refactor the Code

Improve the code while keeping behavior the same:

Make small, incremental changes:
<div class="list-tight">

- Extract one function at a time
- Run tests after each change
- If tests break, fix them before continuing

</div>

Focus on design principles:
<div class="list-tight">

1. **Cohesion:** Extract functions with single responsibilities
1. **DRY:** Remove duplication
1. **Size:** Break long functions into smaller ones
1. **Clarity:** Improve names and structure

</div>

Verify behavior unchanged:
<div class="list-tight">

- Run tests frequently
- All tests should still pass
- Functionality should be identical

</div>

### 1.4. Verify Refactor

Ensure refactoring improved code quality:

<div class="list-tight">

- Run all tests: All should pass
- Check code quality: Are functions smaller? Is duplication reduced? Is code clearer?
- Document improvements: What changed? Why did it improve the code?
</div>


## 2. Extend Existing Feature

### 2.1. Choose Feature to Extend

Select an existing feature to enhance. Recommended extensions (Pick ONE):

#### Option 1. Add Modules to Courses (Recommended)

<div class="list-tight">

- Implement the Module model and endpoints
- Update `GET /api/courses/{id}` to return actual modules (currently returns empty array at line 108)
- Update `GET /api/courses` to return actual module_count (currently hardcoded to 0 at lines 74, 144, 195)
</div>

#### Option 2. Add Pagination to Users Endpoint (Recommended)

<div class="list-tight">

- Add pagination to `GET /api/users` endpoint
- Accept `page` and `limit` query parameters
- Return paginated results with metadata (total count, page number, total pages)
- See `backend/routes/users.py` lines 34-51 for the current implementation
</div>

Create an Issue in the Issue tracker describing the extension.

### 2.2. Write Tests First

Write tests for the new functionality:

<div class="list-tight">

- Test the behavior you want
- Tests will fail initially (that's expected)
- Tests guide your implementation
</div>

Be sure to include success cases (new functionality works), failure cases (errors handled correctly), and edge cases (boundary conditions)


### 2.3. Implement the new functionality


<div class="list-tight">

- Update models/schemas if needed
- Add new endpoints or enhance existing ones
- Ensure backward compatibility
- Run tests frequently
</div>


### 2.4. Verify Extension

Ensure extension works and doesn't break existing code:

<div class="list-tight">

- Run all tests: All should pass
- New tests verify new functionality
- Existing tests verify nothing broke
</div>


## 3. Peer Review
It probably makes sense to have at least 2 pull requests (one for the refactor, one for the enhancement), but your team is welcome to create the number of PRs that makes sense for the task.

Like with earlier assignments, all PRs must be merged and closed by the deadline. All PRs must be reviewed (but it is OK if not everyone reviews this time around -- people who don't review this time can review next time). 

Questions to consider in theA PR:

<div class="list-tight">

- Design: Did the refactoring improve code quality? Is the extension well-designed?
- Tests: Do tests cover the changes? Are they clear and independent?
</div>

Comment on the PR with specific, constructive feedback. Approve if the PR is good, request changes if improvements are needed. Everyone should review at least one PR from your team.

## 4. Individual Reflection

Briefly answer the following questions (300-400 words total) in your Google Doc:

<div class="list-tight">

- What did you learn? - About refactoring/extending code and code quality
- What was challenging? - What was hard or confusing?
- What makes code maintainable? - Based on your experience
</div>

When you're done, copy your reflection and paste it into the <a href="https://forms.gle/m6Myw4Lxc2We3WNCA" target="_blank">Weekly Reflection Form</a>.

## Submission Checklist

**Refactoring**
- [ ] Code refactored (Part 1)
- [ ] All tests pass
- [ ] Code quality improved (functions smaller, duplication reduced, code clearer)

**Extension**
- [ ] Code extended (Part 2)
- [ ] All tests pass
- [ ] New functionality works correctly
- [ ] Existing functionality still works (backward compatible)

**Process**
- [ ] PR(s) created with descriptions covering both parts
- [ ] PR(s) have been reviewed and merged
- [ ] Individual reflection completed and submitted
